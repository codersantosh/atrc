{"version":3,"names":["React","store","blockEditorStore","coreStore","__","sprintf","useSelect","getAvatarSizes","sizes","minSize","maxSize","length","maxSizeBuffer","Math","floor","useDefaultAvatar","_useSelect","select","_select","getSettings","_getSettings","__experimentalDiscussionSettings","defaultAvatarUrl","avatarURL","AtrcUseUserAvatar","_ref","userId","postId","postType","_useSelect2","_getEditedEntityRecor","_select2","getEditedEntityRecord","getUser","authorDetails","_authorId","author","avatarUrls","avatar_urls","Object","values","keys","_getAvatarSizes","defaultAvatar","src","alt","name"],"sources":["D:/wamp/www/atrc-package/atrc/packages/query/post-author-image/use-user-avatar.js"],"sourcesContent":["import React from 'react';\n\n/* WordPress */\r\nimport { store as blockEditorStore } from '@wordpress/block-editor';\r\nimport { store as coreStore } from '@wordpress/core-data';\r\nimport { __, sprintf } from '@wordpress/i18n';\r\nimport { useSelect } from '@wordpress/data';\r\n\r\n/* Local */\r\nfunction getAvatarSizes(sizes) {\r\n\tconst minSize = sizes ? sizes[0] : 24;\r\n\tconst maxSize = sizes ? sizes[sizes.length - 1] : 96;\r\n\tconst maxSizeBuffer = Math.floor(maxSize * 2.5);\r\n\treturn {\r\n\t\tminSize,\r\n\t\tmaxSize: maxSizeBuffer,\r\n\t};\r\n}\r\n\r\nfunction useDefaultAvatar() {\r\n\tconst { avatarURL: defaultAvatarUrl } = useSelect((select) => {\r\n\t\tconst { getSettings } = select(blockEditorStore);\r\n\t\tconst { __experimentalDiscussionSettings } = getSettings();\r\n\t\treturn __experimentalDiscussionSettings;\r\n\t});\r\n\treturn defaultAvatarUrl;\r\n}\r\n\r\nexport default function AtrcUseUserAvatar({ userId, postId, postType }) {\r\n\tconst { authorDetails } = useSelect(\r\n\t\t(select) => {\r\n\t\t\tconst { getEditedEntityRecord, getUser } = select(coreStore);\r\n\t\t\tif (userId) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tauthorDetails: getUser(userId),\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tconst _authorId = getEditedEntityRecord(\r\n\t\t\t\t'postType',\r\n\t\t\t\tpostType,\r\n\t\t\t\tpostId\r\n\t\t\t)?.author;\r\n\r\n\t\t\treturn {\r\n\t\t\t\tauthorDetails: _authorId ? getUser(_authorId) : null,\r\n\t\t\t};\r\n\t\t},\r\n\t\t[postType, postId, userId]\r\n\t);\r\n\tconst avatarUrls = authorDetails?.avatar_urls\r\n\t\t? Object.values(authorDetails.avatar_urls)\r\n\t\t: null;\r\n\tconst sizes = authorDetails?.avatar_urls\r\n\t\t? Object.keys(authorDetails.avatar_urls)\r\n\t\t: null;\r\n\tconst { minSize, maxSize } = getAvatarSizes(sizes);\r\n\tconst defaultAvatar = useDefaultAvatar();\r\n\treturn {\r\n\t\tsrc: avatarUrls ? avatarUrls[avatarUrls.length - 1] : defaultAvatar,\r\n\t\tminSize,\r\n\t\tmaxSize,\r\n\t\talt: authorDetails\r\n\t\t\t? // translators: %s is the Author name.\r\n\t\t\t  sprintf(__('%s Avatar'), authorDetails?.name)\r\n\t\t\t: __('Default Avatar'),\r\n\t};\r\n}\r\n"],"mappings":"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","ignoreList":[]}