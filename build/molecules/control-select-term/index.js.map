{"version":3,"names":["useMemo","useState","__","decodeEntities","useSelect","store","coreStore","classnames","debounce","isArray","isNumber","isString","AtrcDynamicSelect","AtrcNotice","AtrcGetTerms","AtrcPrefix","perPage","getTermsOptions","tax","restBase","restNamespace","queryArgs","gotItems","options","forEach","item","push","value","id","label","name","AtrcControlSelectTerm","props","onChange","showOptionNone","optionNoneValue","variant","className","relation","relationId","defaultProps","hasFixNotice","setHasFixNotice","select","newQueryArgs","per_page","_fields","context","parent","getEntityRecord","gotItem","include","terms","totalItems","getEntityRecords","length","map","term","isAsync","defaultValue","valArray","split","React","createElement","autoDismiss","isDismissible","onAutoRemove","asyncOptions","inputValue","query","search","error","console","debouncedLoadOptions","_extends","loadOptions"],"sources":["D:/wamp/www/atrc-package/atrc/packages/molecules/control-select-term/index.js"],"sourcesContent":["/* WordPress*/\r\n/* WordPress*/\r\nimport { useMemo, useState } from '@wordpress/element';\r\n\r\nimport { __ } from '@wordpress/i18n';\r\n\r\nimport { decodeEntities } from '@wordpress/html-entities';\r\n\r\nimport { useSelect } from '@wordpress/data';\r\n\r\nimport { store as coreStore } from '@wordpress/core-data';\r\n\r\n/*Library*/\r\n\r\nimport classnames from 'classnames';\r\n\r\nimport { debounce, isArray, isNumber, isString } from 'lodash';\r\n\r\n/*Inbuilt */\r\nimport { AtrcDynamicSelect } from '../../atoms/select';\r\n\r\nimport AtrcNotice from '../notice';\r\n\r\nimport AtrcGetTerms from '../../api/get-terms';\r\n\r\n/*Inbuilt*/\r\nimport AtrcPrefix from '../../prefix-vars';\r\n\r\n/* Local*/\r\nconst perPage = 100;\r\n\r\nconst getTermsOptions = async ({\r\n\ttax,\r\n\trestBase,\r\n\trestNamespace,\r\n\tqueryArgs = null,\r\n}) => {\r\n\tconst gotItems = await AtrcGetTerms({\r\n\t\ttax,\r\n\t\trestBase,\r\n\t\trestNamespace,\r\n\t\tqueryArgs,\r\n\t});\r\n\r\n\tconst options = [];\r\n\tif (gotItems) {\r\n\t\tgotItems.forEach(function (item) {\r\n\t\t\toptions.push({\r\n\t\t\t\tvalue: item.id,\r\n\t\t\t\tlabel: item.name || __('Untitled', 'atrc-prefix-atrc'),\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\treturn options;\r\n};\r\n\r\n/*Select Term*/\r\nfunction AtrcControlSelectTerm(props) {\r\n\tconst {\r\n\t\tlabel = __('Terms', 'atrc-prefix-atrc'),\r\n\t\tvalue,\r\n\t\tonChange,\r\n\t\tshowOptionNone = true,\r\n\t\toptionNoneValue = 0,\r\n\t\ttax = '',\r\n\t\tvariant = '',\r\n\t\tclassName = '',\r\n\t\trelation = '',\r\n\t\trelationId = 0,\r\n\t\t...defaultProps\r\n\t} = props;\r\n\r\n\tconst [hasFixNotice, setHasFixNotice] = useState(true);\r\n\r\n\tconst queryArgs = useSelect(\r\n\t\t(select) => {\r\n\t\t\tconst newQueryArgs = {\r\n\t\t\t\tper_page: perPage,\r\n\t\t\t\t_fields: 'id,name',\r\n\t\t\t\tcontext: 'view',\r\n\t\t\t};\r\n\t\t\tif (relation) {\r\n\t\t\t\tif ('child' === relation) {\r\n\t\t\t\t\t/*get children by relation id*/\r\n\t\t\t\t\tnewQueryArgs.parent = [relationId];\r\n\t\t\t\t} else if ('termParent' === relation) {\r\n\t\t\t\t\tconst { getEntityRecord } = select(coreStore);\r\n\r\n\t\t\t\t\tconst gotItem = getEntityRecord('taxonomy', tax, relationId);\r\n\r\n\t\t\t\t\tif (gotItem && gotItem.parent) {\r\n\t\t\t\t\t\t/*get parent by relation id*/\r\n\t\t\t\t\t\tnewQueryArgs.include = [gotItem.parent];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn newQueryArgs;\r\n\t\t},\r\n\t\t[relation, relationId]\r\n\t);\r\n\r\n\tconst { terms, totalItems } = useSelect(\r\n\t\t(select) => {\r\n\t\t\tconst { getEntityRecords } = select(coreStore);\r\n\r\n\t\t\tconst gotItems = getEntityRecords('taxonomy', tax, queryArgs);\r\n\r\n\t\t\treturn { terms: gotItems, totalItems: gotItems && gotItems.length };\r\n\t\t},\r\n\t\t[tax, queryArgs]\r\n\t);\r\n\r\n\tconst options = useMemo(() => {\r\n\t\treturn (terms ?? []).map((term) => {\r\n\t\t\treturn {\r\n\t\t\t\tvalue: term.id,\r\n\t\t\t\tlabel: decodeEntities(term.name),\r\n\t\t\t};\r\n\t\t});\r\n\t}, [terms]);\r\n\r\n\tconst isAsync = useMemo(() => {\r\n\t\treturn totalItems && totalItems >= perPage;\r\n\t}, [totalItems]);\r\n\r\n\tconst defaultValue = useSelect(\r\n\t\t(select) => {\r\n\t\t\tconst newQueryArgs = {\r\n\t\t\t\t_fields: 'id,name',\r\n\t\t\t\tcontext: 'view',\r\n\t\t\t};\r\n\t\t\tif (isAsync && value) {\r\n\t\t\t\tif (isArray(value)) {\r\n\t\t\t\t\tnewQueryArgs.include = value;\r\n\t\t\t\t} else if (isNumber(value)) {\r\n\t\t\t\t\tnewQueryArgs.include = [value];\r\n\t\t\t\t} else if (isString(value)) {\r\n\t\t\t\t\tconst valArray = value.split(',');\r\n\t\t\t\t\tnewQueryArgs.include = [valArray];\r\n\t\t\t\t}\r\n\t\t\t\tif (newQueryArgs.include) {\r\n\t\t\t\t\tconst { getEntityRecords } = select(coreStore);\r\n\r\n\t\t\t\t\tconst gotItems = getEntityRecords('taxonomy', tax, newQueryArgs);\r\n\t\t\t\t\tif (gotItems && isArray(gotItems) && gotItems.length) {\r\n\t\t\t\t\t\tif (gotItems.length > 1) {\r\n\t\t\t\t\t\t\treturn gotItems.map((term) => {\r\n\t\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\t\tvalue: term.id,\r\n\t\t\t\t\t\t\t\t\tlabel: decodeEntities(term.name),\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tvalue: gotItems[0].id,\r\n\t\t\t\t\t\t\tlabel: decodeEntities(gotItems[0].name),\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t},\r\n\t\t[isAsync, value]\r\n\t);\r\n\r\n\tif (!options || !options.length) {\r\n\t\treturn (\r\n\t\t\t<AtrcNotice\r\n\t\t\t\tautoDismiss={false}\r\n\t\t\t\tisDismissible={false}>\r\n\t\t\t\t{__('No terms found!', 'atrc-prefix-atrc')}\r\n\t\t\t</AtrcNotice>\r\n\t\t);\r\n\t}\r\n\r\n\tif (isAsync) {\r\n\t\tif (hasFixNotice) {\r\n\t\t\treturn (\r\n\t\t\t\t<AtrcNotice\r\n\t\t\t\t\tautoDismiss={5000}\r\n\t\t\t\t\tisDismissible={false}\r\n\t\t\t\t\tonAutoRemove={() => {\r\n\t\t\t\t\t\tsetHasFixNotice(false);\r\n\t\t\t\t\t}}>\r\n\t\t\t\t\t{__('Loadingâ€¦', 'atrc-prefix-atrc')}\r\n\t\t\t\t</AtrcNotice>\r\n\t\t\t);\r\n\t\t}\r\n\t\tconst asyncOptions = async (inputValue) => {\r\n\t\t\ttry {\r\n\t\t\t\tconst query = {\r\n\t\t\t\t\ttax,\r\n\t\t\t\t};\r\n\t\t\t\tif (inputValue) {\r\n\t\t\t\t\tquery.queryArgs = {\r\n\t\t\t\t\t\tsearch: inputValue,\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn await getTermsOptions(query);\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.error('Error fetching WordPress terms:', error);\r\n\t\t\t\treturn [];\r\n\t\t\t}\r\n\t\t};\r\n\t\t// Debounce the loadOptions function with a 300ms delay\r\n\t\tconst debouncedLoadOptions = debounce(asyncOptions, 300);\r\n\t\treturn (\r\n\t\t\t<AtrcDynamicSelect\r\n\t\t\t\tlabel={label}\r\n\t\t\t\tclassName={classnames(\r\n\t\t\t\t\tAtrcPrefix('ctrl-select-term'),\r\n\t\t\t\t\tclassName,\r\n\t\t\t\t\tvariant ? AtrcPrefix('ctrl-select-term') + '-' + variant : ''\r\n\t\t\t\t)}\r\n\t\t\t\tdefaultValue={defaultValue}\r\n\t\t\t\tonChange={onChange}\r\n\t\t\t\tshowOptionNone={showOptionNone}\r\n\t\t\t\toptionNoneValue={optionNoneValue}\r\n\t\t\t\toptions={options}\r\n\t\t\t\tloadOptions={debouncedLoadOptions}\r\n\t\t\t\tisAsync={isAsync}\r\n\t\t\t\t{...defaultProps}\r\n\t\t\t/>\r\n\t\t);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<AtrcDynamicSelect\r\n\t\t\tlabel={label}\r\n\t\t\tclassName={classnames(\r\n\t\t\t\tAtrcPrefix('ctrl-select-term'),\r\n\t\t\t\tclassName,\r\n\t\t\t\tvariant ? AtrcPrefix('ctrl-select-term') + '-' + variant : ''\r\n\t\t\t)}\r\n\t\t\tvalue={value}\r\n\t\t\tonChange={onChange}\r\n\t\t\tshowOptionNone={showOptionNone}\r\n\t\t\toptionNoneValue={optionNoneValue}\r\n\t\t\toptions={options}\r\n\t\t\t{...defaultProps}\r\n\t\t/>\r\n\t);\r\n}\r\n\r\nexport default AtrcControlSelectTerm;\r\n"],"mappings":"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"}