{"version":3,"names":["React","useRef","useEffect","useState","useMergeRefs","Popover","classnames","AtrcWrap","AtrcPrefix","useObservableState","initialState","onStateChange","_useState","_useState2","_slicedToArray","state","setState","value","Dropdown","props","renderContent","renderToggle","className","contentClassName","expandOnMobile","headerTitle","focusOnMount","position","popoverProps","onClose","onToggle","style","_useState3","_useState4","fallbackPopoverAnchor","setFallbackPopoverAnchor","containerRef","_useObservableState","_useObservableState2","isOpen","setIsOpen","toggle","tog","arguments","length","undefined","closeIfFocusOutside","ownerDocument","current","dialog","activeElement","closest","contains","close","args","popoverPropsHaveAnchor","anchor","anchorRef","getAnchorRect","anchorRect","createElement","ref","tabIndex","_extends","onFocusOutside","offset","AtrcDropdownHover","instanceId","AtrcUseInstanceId","timer","_props$className","_props$renderToggle","_props$renderContent","_props$width","width","defaultProps","_objectWithoutProperties","_excluded","isInsideCurrent","element","id","handleMouseLeave","e","setTimeout","document","addEventListener","setDropdownToggle","target","removeEventListener","clearTimeout","_ref","variant","onMouseEnter","onMouseLeave","_ref2"],"sources":["D:/wamp/www/atrc-package/atrc/packages/molecules/dropdown-hover/index.js"],"sourcesContent":["import React from 'react';\n\n/*WordPress*/\r\nimport { useRef, useEffect, useState } from '@wordpress/element';\r\n\r\nimport { useMergeRefs } from '@wordpress/compose';\r\n\r\nimport { Popover } from '@wordpress/components';\r\n\r\n/*Library*/\r\nimport classnames from 'classnames';\r\n\r\n/*Atoms*/\r\nimport AtrcWrap from '../../atoms/wrap';\r\n\r\n/*Prefix*/\r\nimport AtrcPrefix from '../../prefix-vars';\r\n\r\n/*Local*/\r\nfunction useObservableState(initialState, onStateChange) {\r\n\tconst [state, setState] = useState(initialState);\r\n\treturn [\r\n\t\tstate,\r\n\t\t(value) => {\r\n\t\t\tsetState(value);\r\n\t\t\tif (onStateChange) {\r\n\t\t\t\tonStateChange(value);\r\n\t\t\t}\r\n\t\t},\r\n\t];\r\n}\r\n\r\nfunction Dropdown(props) {\r\n\tconst {\r\n\t\trenderContent,\r\n\t\trenderToggle,\r\n\t\tclassName,\r\n\t\tcontentClassName,\r\n\t\texpandOnMobile,\r\n\t\theaderTitle,\r\n\t\tfocusOnMount,\r\n\t\tposition,\r\n\t\tpopoverProps,\r\n\t\tonClose,\r\n\t\tonToggle,\r\n\t\tstyle,\r\n\t} = props;\r\n\r\n\t// Use internal state instead of a ref to make sure that the component\r\n\t// re-renders when the popover's anchor updates.\r\n\tconst [fallbackPopoverAnchor, setFallbackPopoverAnchor] = useState(null);\r\n\tconst containerRef = useRef();\r\n\tconst [isOpen, setIsOpen] = useObservableState(false, onToggle);\r\n\r\n\tuseEffect(\r\n\t\t() => () => {\r\n\t\t\tif (onToggle && isOpen) {\r\n\t\t\t\tonToggle(false);\r\n\t\t\t}\r\n\t\t},\r\n\t\t[onToggle, isOpen]\r\n\t);\r\n\r\n\tfunction toggle(tog = null) {\r\n\t\tif (tog !== null) {\r\n\t\t\tsetIsOpen(tog);\r\n\t\t} else {\r\n\t\t\tsetIsOpen(!isOpen);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Closes the popover when focus leaves it unless the toggle was pressed or\r\n\t * focus has moved to a separate dialog. The former is to let the toggle\r\n\t * handle closing the popover and the latter is to preserve presence in\r\n\t * case a dialog has opened, allowing focus to return when it's dismissed.\r\n\t */\r\n\tfunction closeIfFocusOutside() {\r\n\t\tconst { ownerDocument } = containerRef.current;\r\n\t\tconst dialog = ownerDocument.activeElement.closest('[role=\"dialog\"]');\r\n\t\tif (\r\n\t\t\t!containerRef.current.contains(ownerDocument.activeElement) &&\r\n\t\t\t(!dialog || dialog.contains(containerRef.current))\r\n\t\t) {\r\n\t\t\tclose();\r\n\t\t}\r\n\t}\r\n\r\n\tfunction close() {\r\n\t\tif (onClose) {\r\n\t\t\tonClose();\r\n\t\t}\r\n\t\tsetIsOpen(false);\r\n\t}\r\n\r\n\tconst args = { isOpen, onToggle: toggle, onClose: close };\r\n\tconst popoverPropsHaveAnchor =\r\n\t\t!!popoverProps?.anchor ||\r\n\t\t// Note: `anchorRef`, `getAnchorRect` and `anchorRect` are deprecated and\r\n\t\t// be removed from `Popover` from WordPress 6.3\r\n\t\t!!popoverProps?.anchorRef ||\r\n\t\t!!popoverProps?.getAnchorRect ||\r\n\t\t!!popoverProps?.anchorRect;\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName={classnames('components-dropdown', className)}\r\n\t\t\tref={useMergeRefs([setFallbackPopoverAnchor, containerRef])}\r\n\t\t\t// Some UAs focus the closest focusable parent when the toggle is\r\n\t\t\t// clicked. Making this div focusable ensures such UAs will focus\r\n\t\t\t// it and `closeIfFocusOutside` can tell if the toggle was clicked.\r\n\t\t\ttabIndex='-1'\r\n\t\t\tstyle={style}>\r\n\t\t\t{renderToggle(args)}\r\n\t\t\t{isOpen && (\r\n\t\t\t\t<Popover\r\n\t\t\t\t\tposition={position}\r\n\t\t\t\t\tonClose={close}\r\n\t\t\t\t\tonFocusOutside={closeIfFocusOutside}\r\n\t\t\t\t\texpandOnMobile={expandOnMobile}\r\n\t\t\t\t\theaderTitle={headerTitle}\r\n\t\t\t\t\tfocusOnMount={focusOnMount}\r\n\t\t\t\t\t// This value is used to ensure that the dropdowns\r\n\t\t\t\t\t// align with the editor header by default.\r\n\t\t\t\t\toffset={13}\r\n\t\t\t\t\tanchor={!popoverPropsHaveAnchor ? fallbackPopoverAnchor : undefined}\r\n\t\t\t\t\t{...popoverProps}\r\n\t\t\t\t\tclassName={classnames(\r\n\t\t\t\t\t\t'components-dropdown__content',\r\n\t\t\t\t\t\tpopoverProps ? popoverProps.className : undefined,\r\n\t\t\t\t\t\tcontentClassName\r\n\t\t\t\t\t)}>\r\n\t\t\t\t\t{renderContent(args)}\r\n\t\t\t\t</Popover>\r\n\t\t\t)}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nconst AtrcDropdownHover = (props) => {\r\n\tconst instanceId = AtrcUseInstanceId(\r\n\t\tAtrcDropdownHover,\r\n\t\t'atrc-ctrl-dropdown-hover'\r\n\t);\r\n\r\n\tlet timer;\r\n\tconst {\r\n\t\tclassName = '',\r\n\t\trenderToggle = '',\r\n\t\trenderContent = '',\r\n\t\twidth = '300px',\r\n\t\t...defaultProps\r\n\t} = props;\r\n\r\n\tfunction isInsideCurrent(element) {\r\n\t\tif (element.id === instanceId) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn element.closest('#' + instanceId);\r\n\t}\r\n\r\n\tfunction handleMouseLeave(onToggle, e) {\r\n\t\ttimer = setTimeout(() => {\r\n\t\t\tdocument.addEventListener('mousemove', setDropdownToggle, false);\r\n\t\t\tfunction setDropdownToggle(e) {\r\n\t\t\t\tif (!isInsideCurrent(e.target)) {\r\n\t\t\t\t\tonToggle(false);\r\n\t\t\t\t}\r\n\t\t\t\tdocument.removeEventListener('mousemove', setDropdownToggle, false);\r\n\t\t\t}\r\n\t\t}, 300);\r\n\t}\r\n\r\n\tuseEffect(() => {\r\n\t\treturn () => {\r\n\t\t\tif (timer) {\r\n\t\t\t\tclearTimeout(timer);\r\n\t\t\t}\r\n\t\t};\r\n\t}, []);\r\n\r\n\treturn (\r\n\t\t<Dropdown\r\n\t\t\tclassName={classnames(AtrcPrefix('dropdown-hover'), className)}\r\n\t\t\trenderToggle={({ isOpen, onToggle }) => (\r\n\t\t\t\t<AtrcWrap\r\n\t\t\t\t\tvariant='render-toggle'\r\n\t\t\t\t\tonMouseEnter={() => onToggle(true)}\r\n\t\t\t\t\tonMouseLeave={(e) => handleMouseLeave(onToggle, e)}\r\n\t\t\t\t\taria-expanded={isOpen}>\r\n\t\t\t\t\t{renderToggle}\r\n\t\t\t\t</AtrcWrap>\r\n\t\t\t)}\r\n\t\t\trenderContent={({ isOpen, onToggle }) => (\r\n\t\t\t\t<AtrcWrap\r\n\t\t\t\t\tid={instanceId}\r\n\t\t\t\t\tvariant='dropdown-hover-cont'\r\n\t\t\t\t\tstyle={{ width }}\r\n\t\t\t\t\tonMouseLeave={(e) => handleMouseLeave(onToggle, e)}>\r\n\t\t\t\t\t{renderContent}\r\n\t\t\t\t</AtrcWrap>\r\n\t\t\t)}\r\n\t\t\t{...defaultProps}\r\n\t\t/>\r\n\t);\r\n};\r\n\r\nexport default AtrcDropdownHover;\r\n"],"mappings":"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","ignoreList":[]}