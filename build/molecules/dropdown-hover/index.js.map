{"version":3,"names":["useRef","useEffect","useState","useInstanceId","useMergeRefs","Popover","classnames","AtrcWrap","AtrcPrefix","useObservableState","initialState","onStateChange","state","setState","value","Dropdown","props","renderContent","renderToggle","className","contentClassName","expandOnMobile","headerTitle","focusOnMount","position","popoverProps","onClose","onToggle","style","fallbackPopoverAnchor","setFallbackPopoverAnchor","containerRef","isOpen","setIsOpen","toggle","tog","closeIfFocusOutside","ownerDocument","current","dialog","activeElement","closest","contains","close","args","popoverPropsHaveAnchor","anchor","anchorRef","getAnchorRect","anchorRect","React","createElement","ref","tabIndex","_extends","onFocusOutside","offset","undefined","AtrcDropdownHover","instanceId","timer","width","defaultProps","isInsideCurrent","element","id","handleMouseLeave","e","setTimeout","document","addEventListener","setDropdownToggle","target","removeEventListener","clearTimeout","variant","onMouseEnter","onMouseLeave"],"sources":["D:/wamp/www/atrc-package/atrc/packages/molecules/dropdown-hover/index.js"],"sourcesContent":["/*WordPress*/\r\nimport { useRef, useEffect, useState } from '@wordpress/element';\r\n\r\nimport { useInstanceId, useMergeRefs } from '@wordpress/compose';\r\n\r\nimport { Popover } from '@wordpress/components';\r\n\r\n/*Library*/\r\nimport classnames from 'classnames';\r\n\r\n/*Inbuilt*/\r\nimport AtrcWrap from '../../atoms/wrap';\r\n\r\n/*Inbuilt*/\r\nimport AtrcPrefix from '../../prefix-vars';\r\n\r\n/*Local components and functions*/\r\nfunction useObservableState(initialState, onStateChange) {\r\n\tconst [state, setState] = useState(initialState);\r\n\treturn [\r\n\t\tstate,\r\n\t\t(value) => {\r\n\t\t\tsetState(value);\r\n\t\t\tif (onStateChange) {\r\n\t\t\t\tonStateChange(value);\r\n\t\t\t}\r\n\t\t},\r\n\t];\r\n}\r\n\r\nfunction Dropdown(props) {\r\n\tconst {\r\n\t\trenderContent,\r\n\t\trenderToggle,\r\n\t\tclassName,\r\n\t\tcontentClassName,\r\n\t\texpandOnMobile,\r\n\t\theaderTitle,\r\n\t\tfocusOnMount,\r\n\t\tposition,\r\n\t\tpopoverProps,\r\n\t\tonClose,\r\n\t\tonToggle,\r\n\t\tstyle,\r\n\t} = props;\r\n\t// Use internal state instead of a ref to make sure that the component\r\n\t// re-renders when the popover's anchor updates.\r\n\tconst [fallbackPopoverAnchor, setFallbackPopoverAnchor] = useState(null);\r\n\tconst containerRef = useRef();\r\n\tconst [isOpen, setIsOpen] = useObservableState(false, onToggle);\r\n\r\n\tuseEffect(\r\n\t\t() => () => {\r\n\t\t\tif (onToggle && isOpen) {\r\n\t\t\t\tonToggle(false);\r\n\t\t\t}\r\n\t\t},\r\n\t\t[onToggle, isOpen]\r\n\t);\r\n\r\n\tfunction toggle(tog = null) {\r\n\t\tif (tog !== null) {\r\n\t\t\tsetIsOpen(tog);\r\n\t\t} else {\r\n\t\t\tsetIsOpen(!isOpen);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Closes the popover when focus leaves it unless the toggle was pressed or\r\n\t * focus has moved to a separate dialog. The former is to let the toggle\r\n\t * handle closing the popover and the latter is to preserve presence in\r\n\t * case a dialog has opened, allowing focus to return when it's dismissed.\r\n\t */\r\n\tfunction closeIfFocusOutside() {\r\n\t\tconst { ownerDocument } = containerRef.current;\r\n\t\tconst dialog = ownerDocument.activeElement.closest('[role=\"dialog\"]');\r\n\t\tif (\r\n\t\t\t!containerRef.current.contains(ownerDocument.activeElement) &&\r\n\t\t\t(!dialog || dialog.contains(containerRef.current))\r\n\t\t) {\r\n\t\t\tclose();\r\n\t\t}\r\n\t}\r\n\r\n\tfunction close() {\r\n\t\tif (onClose) {\r\n\t\t\tonClose();\r\n\t\t}\r\n\t\tsetIsOpen(false);\r\n\t}\r\n\r\n\tconst args = { isOpen, onToggle: toggle, onClose: close };\r\n\tconst popoverPropsHaveAnchor =\r\n\t\t!!popoverProps?.anchor ||\r\n\t\t// Note: `anchorRef`, `getAnchorRect` and `anchorRect` are deprecated and\r\n\t\t// be removed from `Popover` from WordPress 6.3\r\n\t\t!!popoverProps?.anchorRef ||\r\n\t\t!!popoverProps?.getAnchorRect ||\r\n\t\t!!popoverProps?.anchorRect;\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName={classnames('components-dropdown', className)}\r\n\t\t\tref={useMergeRefs([setFallbackPopoverAnchor, containerRef])}\r\n\t\t\t// Some UAs focus the closest focusable parent when the toggle is\r\n\t\t\t// clicked. Making this div focusable ensures such UAs will focus\r\n\t\t\t// it and `closeIfFocusOutside` can tell if the toggle was clicked.\r\n\t\t\ttabIndex='-1'\r\n\t\t\tstyle={style}>\r\n\t\t\t{renderToggle(args)}\r\n\t\t\t{isOpen && (\r\n\t\t\t\t<Popover\r\n\t\t\t\t\tposition={position}\r\n\t\t\t\t\tonClose={close}\r\n\t\t\t\t\tonFocusOutside={closeIfFocusOutside}\r\n\t\t\t\t\texpandOnMobile={expandOnMobile}\r\n\t\t\t\t\theaderTitle={headerTitle}\r\n\t\t\t\t\tfocusOnMount={focusOnMount}\r\n\t\t\t\t\t// This value is used to ensure that the dropdowns\r\n\t\t\t\t\t// align with the editor header by default.\r\n\t\t\t\t\toffset={13}\r\n\t\t\t\t\tanchor={!popoverPropsHaveAnchor ? fallbackPopoverAnchor : undefined}\r\n\t\t\t\t\t{...popoverProps}\r\n\t\t\t\t\tclassName={classnames(\r\n\t\t\t\t\t\t'components-dropdown__content',\r\n\t\t\t\t\t\tpopoverProps ? popoverProps.className : undefined,\r\n\t\t\t\t\t\tcontentClassName\r\n\t\t\t\t\t)}>\r\n\t\t\t\t\t{renderContent(args)}\r\n\t\t\t\t</Popover>\r\n\t\t\t)}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nconst AtrcDropdownHover = (props) => {\r\n\tconst instanceId = useInstanceId(\r\n\t\tAtrcDropdownHover,\r\n\t\tAtrcPrefix('ctrl-dropdown-hover')\r\n\t);\r\n\r\n\tlet timer;\r\n\tconst {\r\n\t\tclassName = '',\r\n\t\trenderToggle = '',\r\n\t\trenderContent = '',\r\n\t\twidth = '300px',\r\n\t\t...defaultProps\r\n\t} = props;\r\n\r\n\tfunction isInsideCurrent(element) {\r\n\t\tif (element.id === instanceId) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn element.closest('#' + instanceId);\r\n\t}\r\n\r\n\tfunction handleMouseLeave(onToggle, e) {\r\n\t\ttimer = setTimeout(() => {\r\n\t\t\tdocument.addEventListener('mousemove', setDropdownToggle, false);\r\n\t\t\tfunction setDropdownToggle(e) {\r\n\t\t\t\tif (!isInsideCurrent(e.target)) {\r\n\t\t\t\t\tonToggle(false);\r\n\t\t\t\t}\r\n\t\t\t\tdocument.removeEventListener('mousemove', setDropdownToggle, false);\r\n\t\t\t}\r\n\t\t}, 300);\r\n\t}\r\n\r\n\tuseEffect(() => {\r\n\t\treturn () => {\r\n\t\t\tif (timer) {\r\n\t\t\t\tclearTimeout(timer);\r\n\t\t\t}\r\n\t\t};\r\n\t}, []);\r\n\r\n\treturn (\r\n\t\t<Dropdown\r\n\t\t\tclassName={classnames(AtrcPrefix('dropdown-hover'), className)}\r\n\t\t\trenderToggle={({ isOpen, onToggle }) => (\r\n\t\t\t\t<AtrcWrap\r\n\t\t\t\t\tvariant='render-toggle'\r\n\t\t\t\t\tonMouseEnter={() => onToggle(true)}\r\n\t\t\t\t\tonMouseLeave={(e) => handleMouseLeave(onToggle, e)}\r\n\t\t\t\t\taria-expanded={isOpen}>\r\n\t\t\t\t\t{renderToggle}\r\n\t\t\t\t</AtrcWrap>\r\n\t\t\t)}\r\n\t\t\trenderContent={({ isOpen, onToggle }) => (\r\n\t\t\t\t<AtrcWrap\r\n\t\t\t\t\tid={instanceId}\r\n\t\t\t\t\tvariant='dropdown-hover-cont'\r\n\t\t\t\t\tstyle={{ width }}\r\n\t\t\t\t\tonMouseLeave={(e) => handleMouseLeave(onToggle, e)}>\r\n\t\t\t\t\t{renderContent}\r\n\t\t\t\t</AtrcWrap>\r\n\t\t\t)}\r\n\t\t\t{...defaultProps}\r\n\t\t/>\r\n\t);\r\n};\r\n\r\nexport default AtrcDropdownHover;\r\n"],"mappings":"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"}