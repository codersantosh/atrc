{"version":3,"names":["__","sprintf","useState","useMemo","useEffect","classnames","AtrcCombobox","AtrcSpinner","AtrcNotice","AtrcPanelRow","AtrcControlSelectGoogleFontsWeight","AtrcControlSelectGoogleFontsPreview","googleFonts","AtrcControlSelectGoogleFonts","props","apiKey","onChange","value","family","weight","fonts","setFonts","error","setError","loading","setLoading","filteredOptions","setFilteredOptions","fetchFonts","response","fetch","ok","errorMsg","statusText","Error","data","json","items","setFontFamily","newVal","setAttr","type","sort","a","b","join","valueCloned","Object","assign","fontOptions","length","map","item","label","React","createElement","isDismissible","autoDismiss","message","Fragment","className","wrapProps","options","onFilterValueChange","inputValue","filter","option","toLowerCase","startsWith","font"],"sources":["D:/wamp/www/atrc-package/atrc/packages/molecules/control-select-google-fonts/index.js"],"sourcesContent":["/*WordPress*/\r\nimport { __, sprintf } from '@wordpress/i18n';\r\n\r\nimport { useState, useMemo, useEffect } from '@wordpress/element';\r\n\r\n/*Library*/\r\nimport classnames from 'classnames';\r\n\r\n/*Inbuilt*/\r\nimport AtrcCombobox from '../../atoms/combobox';\r\nimport AtrcSpinner from '../../atoms/spinner';\r\n\r\nimport AtrcNotice from '../notice';\r\nimport AtrcPanelRow from '../panel-row';\r\n\r\nimport AtrcControlSelectGoogleFontsWeight from './font-weight';\r\nimport AtrcControlSelectGoogleFontsPreview from './fonts-preview';\r\n\r\n/*Local*/\r\nimport googleFonts from './webfonts.json';\r\n\r\nconst AtrcControlSelectGoogleFonts = (props) => {\r\n\tconst { apiKey = '', onChange, value } = props;\r\n\r\n\tconst { family = '', weight = '' } = value;\r\n\r\n\tconst [fonts, setFonts] = useState([]);\r\n\tconst [error, setError] = useState(null);\r\n\tconst [loading, setLoading] = useState(true);\r\n\tconst [filteredOptions, setFilteredOptions] = useState([]);\r\n\r\n\tuseEffect(() => {\r\n\t\tasync function fetchFonts() {\r\n\t\t\ttry {\r\n\t\t\t\tconst response = await fetch(\r\n\t\t\t\t\t`https://www.googleapis.com/webfonts/v1/webfonts?sort=popularity&key=${apiKey}`\r\n\t\t\t\t);\r\n\t\t\t\tif (!response.ok) {\r\n\t\t\t\t\tlet errorMsg = response.statusText;\r\n\t\t\t\t\tif (!errorMsg) {\r\n\t\t\t\t\t\terrorMsg = __(\r\n\t\t\t\t\t\t\t'Bad response from the server. Make sure the API key is correct.',\r\n\t\t\t\t\t\t\t'atrc-prefix-atrc'\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthrow new Error(errorMsg);\r\n\t\t\t\t}\r\n\t\t\t\tconst data = await response.json();\r\n\t\t\t\tsetFonts(data.items);\r\n\t\t\t} catch (error) {\r\n\t\t\t\tsetError(error);\r\n\t\t\t} finally {\r\n\t\t\t\tsetLoading(false);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (apiKey) {\r\n\t\t\tfetchFonts();\r\n\t\t} else {\r\n\t\t\tsetFonts(googleFonts.items);\r\n\t\t\tsetLoading(false);\r\n\t\t}\r\n\t}, []);\r\n\r\n\tconst setFontFamily = (newVal) => {\r\n\t\tonChange({\r\n\t\t\tfamily: newVal,\r\n\t\t\tweight: '',\r\n\t\t});\r\n\t};\r\n\r\n\tconst setAttr = (newVal, type = 'weight') => {\r\n\t\tif ('weight' === type) {\r\n\t\t\tnewVal.sort((a, b) => a - b);\r\n\t\t\t// Convert the sorted array to a comma-separated string\r\n\t\t\tnewVal = newVal.join(',');\r\n\t\t}\r\n\t\tconst valueCloned = Object.assign({}, value);\r\n\t\tvalueCloned[type] = newVal;\r\n\t\tonChange(valueCloned);\r\n\t};\r\n\r\n\tconst fontOptions = useMemo(() => {\r\n\t\treturn fonts && fonts.length\r\n\t\t\t? fonts.map((item) => ({ label: item.family, value: item.family }))\r\n\t\t\t: [];\r\n\t}, [fonts]);\r\n\r\n\tuseEffect(() => {\r\n\t\tsetFilteredOptions(\r\n\t\t\tfonts && fonts.length\r\n\t\t\t\t? fonts.map((item) => ({ label: item.family, value: item.family }))\r\n\t\t\t\t: []\r\n\t\t);\r\n\t}, [fontOptions]);\r\n\r\n\tif (error) {\r\n\t\treturn (\r\n\t\t\t<AtrcNotice\r\n\t\t\t\tisDismissible={false}\r\n\t\t\t\tautoDismiss={false}>\r\n\t\t\t\t{sprintf(\r\n\t\t\t\t\t__('An error occurred: %s', 'atrc-prefix-atrc'),\r\n\t\t\t\t\terror.message\r\n\t\t\t\t)}\r\n\t\t\t</AtrcNotice>\r\n\t\t);\r\n\t}\r\n\r\n\tif (loading) {\r\n\t\treturn <AtrcSpinner />;\r\n\t}\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<AtrcPanelRow className={classnames('at-m')}>\r\n\t\t\t\t<AtrcCombobox\r\n\t\t\t\t\tlabel={__('Google font family')}\r\n\t\t\t\t\twrapProps={{\r\n\t\t\t\t\t\tclassName: 'at-flx-grw-1',\r\n\t\t\t\t\t}}\r\n\t\t\t\t\tvalue={family}\r\n\t\t\t\t\tonChange={setFontFamily}\r\n\t\t\t\t\toptions={filteredOptions}\r\n\t\t\t\t\tonFilterValueChange={(inputValue) =>\r\n\t\t\t\t\t\tsetFilteredOptions(\r\n\t\t\t\t\t\t\tfontOptions.filter((option) =>\r\n\t\t\t\t\t\t\t\toption.label.toLowerCase().startsWith(inputValue.toLowerCase())\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t}\r\n\t\t\t\t/>\r\n\t\t\t</AtrcPanelRow>\r\n\t\t\t{family ? (\r\n\t\t\t\t<>\r\n\t\t\t\t\t<AtrcPanelRow className={classnames('at-m')}>\r\n\t\t\t\t\t\t<AtrcControlSelectGoogleFontsWeight\r\n\t\t\t\t\t\t\tlabel={__('Font weight')}\r\n\t\t\t\t\t\t\twrapProps={{\r\n\t\t\t\t\t\t\t\tclassName: 'at-flx-grw-1',\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\tvalue={weight}\r\n\t\t\t\t\t\t\tonChange={setAttr}\r\n\t\t\t\t\t\t\tfonts={fonts}\r\n\t\t\t\t\t\t\tfamily={family}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</AtrcPanelRow>\r\n\t\t\t\t\t<AtrcPanelRow\r\n\t\t\t\t\t\tclassName={classnames('at-m', 'at-flx-col', 'at-al-itm-st')}>\r\n\t\t\t\t\t\t<AtrcControlSelectGoogleFontsPreview\r\n\t\t\t\t\t\t\tfont={value.family}\r\n\t\t\t\t\t\t\tweight={value.weight}\r\n\t\t\t\t\t\t\twrapProps={{\r\n\t\t\t\t\t\t\t\tclassName: 'at-flx-grw-1',\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</AtrcPanelRow>\r\n\t\t\t\t</>\r\n\t\t\t) : null}\r\n\t\t</>\r\n\t);\r\n};\r\nexport {\r\n\tAtrcControlSelectGoogleFontsWeight,\r\n\tAtrcControlSelectGoogleFontsPreview,\r\n};\r\nexport default AtrcControlSelectGoogleFonts;\r\n"],"mappings":"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"}