{"version":3,"names":["__","useState","useMemo","Fragment","classnames","escape","map","AtrcText","AtrcPanelTools","AtrcNotice","AtrcPrefix","AtrcControlCustomAttributes","props","label","className","variant","value","notAllowedAttributes","onChange","inputValue","setInputValue","Object","entries","name","val","join","error","setError","handleBlur","attributeRegex","updatedAttributes","duplicateAttributes","disallowedAttributes","matches","match","exec","push","fullMatch","value1","name2","value2","name3","attributeName","attributeValue","includes","length","AttributesTabs","title","hasValue","onDeselect","React","createElement","resetAll","tools","activeItems","tab","iDx","key","onBlur","newVal","undefined","help","isDismissible","autoDismiss","status"],"sources":["D:/wamp/www/atrc-package/atrc/packages/molecules/control-custom-attributes/index.js"],"sourcesContent":["/*Value Structure\r\nType object\r\n{\r\ndata-title: 'my-title'\r\n}\r\n**/\r\n\r\n/*WordPress*/\r\nimport { __ } from '@wordpress/i18n';\r\n\r\nimport { useState, useMemo, Fragment } from '@wordpress/element';\r\n\r\n/** Libraries */\r\nimport classnames from 'classnames';\r\n\r\nimport { escape, map } from 'lodash';\r\n\r\n/*Inbuilt*/\r\nimport AtrcText from '../../atoms/text';\r\n\r\nimport AtrcPanelTools from '../panel-tools';\r\nimport AtrcNotice from '../notice';\r\nimport AtrcPrefix from '../../prefix-vars';\r\n\r\n/*Local components*/\r\nconst AtrcControlCustomAttributes = (props) => {\r\n\tconst {\r\n\t\tlabel = '',\r\n\t\tclassName = '',\r\n\t\tvariant = '',\r\n\t\tvalue = {},\r\n\t\tnotAllowedAttributes = [],\r\n\t\tonChange = () => {},\r\n\t} = props;\r\n\r\n\tconst [inputValue, setInputValue] = useState(\r\n\t\tObject.entries(value)\r\n\t\t\t.map(([name, val]) => `${name}='${val}'`)\r\n\t\t\t.join(' ')\r\n\t);\r\n\tconst [error, setError] = useState('');\r\n\r\n\tconst handleBlur = () => {\r\n\t\tif (!inputValue) {\r\n\t\t\tonChange({});\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst attributeRegex =\r\n\t\t\t/\\b([\\w-]+?)=['\"](.+?)['\"]|\\b([\\w-]+?)=['](.+?)[']|\\b([\\w-]+)/g;\r\n\t\tconst updatedAttributes = {};\r\n\t\tconst duplicateAttributes = [];\r\n\t\tconst disallowedAttributes = [];\r\n\r\n\t\tconst matches = [];\r\n\t\tlet match;\r\n\t\twhile ((match = attributeRegex.exec(inputValue))) {\r\n\t\t\tmatches.push(match);\r\n\t\t}\r\n\r\n\t\t// eslint-disable-next-line no-unused-vars\r\n\t\tfor (const [fullMatch, name, value1, name2, value2, name3] of matches) {\r\n\t\t\tlet attributeName;\r\n\t\t\tlet attributeValue;\r\n\t\t\tif (name2 || name3) {\r\n\t\t\t\tattributeName = escape(name2 || name3);\r\n\t\t\t\tattributeValue = escape(value2 || true);\r\n\t\t\t} else {\r\n\t\t\t\tattributeName = escape(name);\r\n\t\t\t\tattributeValue = escape(value1);\r\n\t\t\t}\r\n\t\t\tif (attributeName) {\r\n\t\t\t\tif (notAllowedAttributes.includes(attributeName)) {\r\n\t\t\t\t\tdisallowedAttributes.push(attributeName);\r\n\t\t\t\t} else if (updatedAttributes[attributeName]) {\r\n\t\t\t\t\tduplicateAttributes.push(attributeName);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tupdatedAttributes[attributeName] = attributeValue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (matches.length === 0) {\r\n\t\t\tsetError('Invalid attribute(s)');\r\n\t\t} else if (duplicateAttributes.length > 0) {\r\n\t\t\tsetError(\r\n\t\t\t\t`Attribute(s) \"${duplicateAttributes.join(\r\n\t\t\t\t\t', '\r\n\t\t\t\t)}\" are used more than once`\r\n\t\t\t);\r\n\t\t} else if (disallowedAttributes.length > 0) {\r\n\t\t\tsetError(\r\n\t\t\t\t`Attribute(s) \"${disallowedAttributes.join(', ')}\" are not allowed`\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tsetError('');\r\n\t\t}\r\n\t\tonChange(updatedAttributes);\r\n\t};\r\n\r\n\tconst AttributesTabs = useMemo(() => {\r\n\t\treturn [\r\n\t\t\t{\r\n\t\t\t\tname: 'attributes',\r\n\t\t\t\ttitle: label,\r\n\t\t\t\thasValue: value && value.length,\r\n\t\t\t\tonDeselect: () => onChange({}),\r\n\t\t\t},\r\n\t\t];\r\n\t}, []);\r\n\treturn (\r\n\t\t<AtrcPanelTools\r\n\t\t\tclassName={classnames(\r\n\t\t\t\tAtrcPrefix('ctrl-cust-attrib'),\r\n\t\t\t\tclassName,\r\n\t\t\t\tvariant ? AtrcPrefix('ctrl-cust-attrib') + '-' + variant : ''\r\n\t\t\t)}\r\n\t\t\tlabel={label}\r\n\t\t\tresetAll={() => onChange({})}\r\n\t\t\ttools={AttributesTabs}>\r\n\t\t\t{(activeItems) =>\r\n\t\t\t\tmap(activeItems, (tab, iDx) => (\r\n\t\t\t\t\t<Fragment key={iDx}>\r\n\t\t\t\t\t\t<AtrcText\r\n\t\t\t\t\t\t\tlabel={label}\r\n\t\t\t\t\t\t\tvalue={inputValue}\r\n\t\t\t\t\t\t\tonBlur={handleBlur}\r\n\t\t\t\t\t\t\tonChange={(newVal) => {\r\n\t\t\t\t\t\t\t\tif (undefined === newVal || '' === newVal || null === newVal) {\r\n\t\t\t\t\t\t\t\t\tonChange({});\r\n\t\t\t\t\t\t\t\t\tsetInputValue('');\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tsetInputValue(newVal);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\thelp={\r\n\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t{__(\r\n\t\t\t\t\t\t\t\t\t\t'You can type in custom HTML attributes for this block in the field above.',\r\n\t\t\t\t\t\t\t\t\t\t'atrc-prefix-atrc'\r\n\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t&nbsp;\r\n\t\t\t\t\t\t\t\t\t{__('Example:', 'atrc-prefix-atrc')}\r\n\t\t\t\t\t\t\t\t\t<br />\r\n\t\t\t\t\t\t\t\t\t<code>{`data-title=\"my-title\"`}</code>\r\n\t\t\t\t\t\t\t\t\t<br />\r\n\t\t\t\t\t\t\t\t\t{__(\r\n\t\t\t\t\t\t\t\t\t\t\"If the attributes are already present on the blocks it wouldn't apply.\",\r\n\t\t\t\t\t\t\t\t\t\t'atrc-prefix-atrc'\r\n\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t{error && (\r\n\t\t\t\t\t\t\t<AtrcNotice\r\n\t\t\t\t\t\t\t\tisDismissible={false}\r\n\t\t\t\t\t\t\t\tautoDismiss={false}\r\n\t\t\t\t\t\t\t\tstatus='warning'>\r\n\t\t\t\t\t\t\t\t{error}\r\n\t\t\t\t\t\t\t</AtrcNotice>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</Fragment>\r\n\t\t\t\t))\r\n\t\t\t}\r\n\t\t</AtrcPanelTools>\r\n\t);\r\n};\r\n\r\nexport default AtrcControlCustomAttributes;\r\n"],"mappings":"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"}